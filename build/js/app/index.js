require(["jquery","swiper","bscroll","getSlideDirection","text!bookTB","render","text!indexTpl","text!bookLR","storage"],function(c,r,e,n,t,s,a,o,i){c("body").append(t),c("body").append(a),c("body").append(o);var l,d,p,u=c(".line");function m(e){l.slideTo(e),c(".tab-item").eq(e).addClass("active").siblings().removeClass("active"),1===e?u.addClass("move"):u.removeClass("move")}document.addEventListener("touchstart",function(e){d=e.touches[0].pageX,p=e.touches[0].pageY},!1),document.addEventListener("touchend",function(e){var t,a;switch(t=e.changedTouches[0].pageX,a=e.changedTouches[0].pageY,n(d,p,t,a)){case 3:m(1);break;case 4:m(0)}},!1),c(".tab-wrap").on("click","span",function(){var e=c(this).index();c(this).addClass("active").siblings().removeClass("active"),1===e?u.addClass("move"):u.removeClass("move"),l.slideTo(e)});var h=new e(".book-city",{probeType:2,click:!0,scrollY:!0}),f=c(".book-city>div"),v=1,g=document.getElementsByTagName("html")[0].style.fontSize,b=parseInt(g)*(44/37.5);function y(e){c.ajax({url:"/api/recommend?pagenum="+e,dataType:"json",success:function(e){var t;console.log(e),1===e.code&&(t=e.data,s("#l-r-tpl",".loadmore",t.items),h.refresh())},error:function(e){console.warn(e)}})}h.on("scroll",function(){var e=this.y,t=this.maxScrollY;e<t-b?v<3?f.attr("up","释放加载更多"):f.attr("up","加载完毕"):e<t-b/2?v<3?f.attr("up","上拉加载"):f.attr("up","加载完毕"):b<e&&f.attr("down","释放刷新")}),h.on("touchEnd",function(){"释放加载更多"===f.attr("up")?(console.log("请求数据，上拉加载"),v<3?(y(++v),f.attr("up","上拉加载")):f.attr("up","加载完毕")):"释放刷新"===f.attr("down")&&location.reload()}),y(v),c.ajax({url:"/api/index",dataType:"json",success:function(e){1==e.code&&function(e){var t=e.items[0].data.data.filter(function(e){return 0!=e.size});s("#banner-swiper-tpl",".banner",t),new r(".banner-swiper",{autoplay:3e3,loop:!0});var a=e.items[0].data.data.filter(function(e){return 0==e.size});s("#types-tpl",".types",a);var n=e.items[1].data.data;s("#book-t-b",".hot",n);var o=function(e,t){for(var a=Math.ceil(e.length/t),n=[],o=0;o<a;o++)n.push(e.splice(0,t));return n}(e.items[2].data.data,5);var i=0;s("#recommend-tpl",".recommend",o[i],!0),c(".content").show(),l=new r(".wrap-swiper"),c(".change-btn").on("click",function(){++i==o.length&&(i=0),s("#recommend-tpl",".recommend",o[i],!0)})}(e.data),console.log(e)},error:function(e){console.warn(e)}}),c(".switch-btn").on("click",function(){c(".shelf-list").toggleClass("chang-style")}),c(".types").on("click","dl",function(){var e,t=c(this).find("dd").text();"女生"==t?e="female":"男生"==t&&(e="boy"),location.href="../../page/list.html?type="+e}),c(".hot").on("click","li",function(){var e=c(this).attr("data-id");location.href="../../page/detail.html?fiction_id="+e}),c(".icon-person").on("click",function(){var e=i.get("code")||0;location.href=e?"../../page/my.html":"../../page/login.html"})});