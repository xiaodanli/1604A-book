require(["jquery","storage","getRequest","base64","render"],function(c,i,t,e,a){var n=c(".set-wrap"),o=t.fiction_id;c(".artical-content").on("click",function(){n.show()}),c(".mask").on("click",function(){n.hide(),c(".set-panel").hide(),c(".font-btn").removeClass("active")}),c(".font-btn").on("click",function(){c(this).toggleClass("active"),c(".set-panel").toggle()});var s=i.get("fz")||14;c(".big-btn").on("click",function(){s<30&&(s+=2),c(".artical-content p").css("fontSize",s/37.5*1+"rem"),i.set("fz",s)}),c(".small-btn").on("click",function(){10<s&&(s-=2),c(".artical-content p").css("fontSize",s/37.5*1+"rem"),i.set("fz",s)});var l=i.get("bg")||"#f7eee5",r=i.get("index")||0,d="夜间"===(i.get("tag")||"夜间"),f=c(".day-btn"),u=c(".artical-content"),g=c(".bg-list li");function h(){f.find("dd").text("夜间"),f.removeClass("light"),u.css("background",l),g.eq(r).addClass("active").siblings().removeClass("active")}function p(){f.find("dd").text("白天"),f.addClass("light"),u.css("background","#0f1410"),g.eq(5).addClass("active").siblings().removeClass("active")}d?h():p(),c(".bg-list").on("click","li",function(){l=c(this).attr("data-bg"),r=c(this).index(),d&&c(".artical-content").css("background",l),c(this).addClass("active").siblings().removeClass("active"),i.set("bg",l),i.set("index",r)}),c(".day-btn").on("click",function(){(d=!d)?h():p();var t=d?"夜间":"白天";i.set("tag",t)}),c.ajax({url:"/api/chapterList?fiction_id="+o,dataType:"json",success:function(t){1===t.code&&c(".total").html(t.data.item.toc.length)},error:function(t){console.warn(t)}});c(".cur");var b=i.get(o)||1,v=i.get(o+"already")||[];function m(n){c.ajax({url:"/api/artical?fiction_id="+o+"&chapter_id="+n,dataType:"json",success:function(t){if(console.log(t),1===t.code){-1==v.indexOf(n)&&(v.push(n),i.set(o+"already",v));var e=document.createElement("script");e.src=t.data.jsonp,window.duokan_fiction_chapter=function(t){var e=JSON.parse(c.base64().decode(t));a("#artical-tpl",".artical-content",e,!0),c(".artical-content p").css("fontSize",s/37.5*1+"rem")},document.body.appendChild(e)}},error:function(t){console.warn(t)}})}c(".cur").html(b),m(b),c(".prev").on("click",function(){if(1<b){b--;c(".cur");c(".cur").html(b),m(b),i.set(o,b)}else alert("已经到第一章")}),c(".next").on("click",function(){if(b<4){b++;c(".cur");c(".cur").html(b),m(b),i.set(o,b)}else alert("已经到最后一章")}),c(".chapter-btn").on("click",function(){location.href="../../page/chapter-list.html?fiction_id="+o+"&chapter_id="+b}),c(".icon-cricle-back").on("click",function(){location.href="../../page/detail.html?fiction_id="+o})});